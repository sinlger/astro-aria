---
import Button from "../components/button.astro";
// import Projects from "../components/home/projects.astro";
import Separator from "../components/home/separator.astro";
import Writings from "../components/home/writings.astro";
import Layout from "../layouts/main.astro";
import { getEntry } from "astro:content";
import type { CollectionEntry } from "astro:content";
interface Homepage {
  github_proxy: {
    title: string;
    sub_title: string;
    proxy_selector: {
      label: string;
      options?: Array<{
        value: string;
        name: string;
        default: boolean;
        status?: 'active' | 'inactive' | 'maintenance';
        speed?: number;
        description?: string;
      }>;
      remote_config?: {
        enabled: boolean;
        api_url: string;
        cache_duration?: number;
        fallback_to_static?: boolean;
      };
    };
    input_placeholder: string;
    button_text: string;
    warning_notice: {
      main_text: string;
      sub_text: string;
    };
  };
  service_tabs?: {
    tabs: Array<{
      id: string;
      name: string;
      icon_path: string;
      input_label: string;
      input_placeholder: string;
      button_text: string;
      content: {
        title: string;
        description: string;
        info_title: string;
        info_items: string[];
        icon_bg_color: string;
        icon_color: string;
      };
    }>;
  };
}

const homepage = (await getEntry(
  "home",
  "-index",
)) as CollectionEntry<"home">;
const {  github_proxy, service_tabs } = homepage?.data as Homepage;
---

<Layout title="Kai">
  <section class="relative z-20 max-w-2xl mx-auto my-12 px-7 lg:px-0">
    <div class="container">
      <div class="flex justify-center">
        <div class="text-center">
          <h1 class="mb-4 text-4xl md:text-5xl font-bold">{github_proxy.title}</h1>
          <p class="mb-8 text-lg text-neutral-600 dark:text-neutral-300">
            {github_proxy?.sub_title}
          </p>

          <!-- Service Selection -->
          {github_proxy?.proxy_selector && (
            <div class="mb-6 max-w-4xl mx-auto">
              <label
                class="block text-sm font-medium text-neutral-800 dark:text-neutral-200 mb-2"
              >
                {github_proxy.proxy_selector.label}
              </label>
              <div class="relative">
                <select
                  id="proxy-selector"
                  class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-500 focus:border-transparent bg-white dark:bg-neutral-900 text-neutral-800 dark:text-neutral-200 appearance-none cursor-pointer"
                >
                  {github_proxy.proxy_selector.options?.map((option) => (
                    <option value={option.value} selected={option.default}>
                      {option.name}
                    </option>
                  ))}
                </select>
                <!-- 下拉箭头图标 -->
                <div
                  class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none"
                >
                  <svg
                    class="w-5 h-5 text-neutral-500 dark:text-neutral-400"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 9l-7 7-7-7"></path>
                  </svg>
                </div>
              </div>
            </div>
          )}

          <!-- URL Input -->
          <div class="mb-6">
            <div class="flex max-w-4xl mx-auto">
              <input
                type="text"
                id="github-url-input"
                placeholder={github_proxy?.input_placeholder}
                class="flex-1 px-4 py-3 border border-neutral-300 dark:border-neutral-700 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-neutral-500 dark:focus:ring-neutral-400 focus:border-transparent bg-white dark:bg-neutral-900 text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-500 dark:placeholder:text-neutral-400"
              />
              <button
                type="button"
                id="github-proxy-button"
                data-target-input="github-url-input"
                class="px-5 py-3 border border-neutral-300 dark:border-neutral-700 border-l-0 rounded-r-lg bg-neutral-900 text-white dark:bg-neutral-700 dark:text-white hover:bg-neutral-800 dark:hover:bg-neutral-600"
              >
                {github_proxy?.button_text}
              </button>
            </div>
            <!-- Error Message Display -->
            <div id="github-input-error" class="max-w-4xl mx-auto mt-2 hidden">
              <p class="text-sm text-red-500 dark:text-red-400 flex items-center">
                <svg class="w-4 h-4 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                </svg>
                <span id="github-input-error-text"></span>
              </p>
            </div>
          </div>

          <!-- Warning Notice -->
          <div class="bg-orange-50 dark:bg-orange-900/20 border-l-4 border-orange-400 dark:border-orange-500 max-w-4xl mx-auto rounded-r-lg p-3">
            <div class="flex items-center justify-center text-orange-700 dark:text-orange-300 text-sm">
              <svg class="w-4 h-4 text-orange-600 dark:text-orange-400 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
              </svg>
              <span class="font-medium">{github_proxy?.warning_notice?.main_text}</span>
              <span class="mx-2">•</span>
              <span>{github_proxy?.warning_notice?.sub_text}</span>
            </div>
          </div>

          <!-- Service Tabs -->
          {service_tabs && (
            <div class="mt-12" id="service-tabs">
              <div class="border-b border-neutral-200 dark:border-neutral-700">
                <nav class="-mb-px flex justify-center space-x-8">
                  {service_tabs.tabs?.map((tab, index) => (
                    <button
                      class={`border-b-2 py-3 px-4 text-sm font-semibold transition-all duration-300 ease-in-out rounded-t-lg ${
                        index === 0 
                          ? 'border-blue-600 dark:border-blue-400 text-blue-600 dark:text-blue-400 active' 
                          : 'border-transparent text-neutral-500 dark:text-neutral-400 hover:text-blue-600 dark:hover:text-blue-400 hover:border-blue-300 dark:hover:border-blue-300'
                      }`}
                      data-tab={tab.id}
                    >
                      <span class="flex items-center space-x-2">
                        <svg
                          class="w-4 h-4"
                          fill="currentColor"
                          viewBox="0 0 20 20"
                        >
                          <path
                            fill-rule="evenodd"
                            d={tab.icon_path}
                            clip-rule="evenodd"
                          />
                        </svg>
                        <span>{tab.name}</span>
                      </span>
                    </button>
                  ))}
                </nav>
              </div>

              <!-- Tab Content -->
              <div class="mt-6 max-w-4xl mx-auto">
                {service_tabs.tabs?.map((tab, index) => (
                  <div
                    id={`${tab.id}-content`}
                    class={`bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 rounded-xl p-6 shadow-sm ${index !== 0 ? 'hidden' : ''}`}
                  >
                    <!-- 输入区域 -->
                    <div class="mb-6">
                      <label class="block text-neutral-800 dark:text-neutral-200 font-medium mb-3">
                        {tab.input_label}
                      </label>
                      <div class="relative group">
                        <input
                          type="text"
                          disabled
                          id={`${tab.id}-input`}
                          placeholder={tab.input_placeholder}
                          value=""
                          class="w-full px-4 py-3 pr-12 border-2 rounded-lg 
                                 bg-white dark:bg-neutral-900 text-neutral-800 dark:text-neutral-200
                                 focus:outline-none focus:border-blue-500 
                                 focus:ring-4 focus:ring-blue-500/20 dark:focus:ring-blue-500/20
                                 transition-all duration-300 ease-in-out"
                        />
                        <button
                          class="absolute right-3 top-1/2 transform -translate-y-1/2 p-2 text-neutral-500 dark:text-neutral-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-200 group-hover:scale-110"
                          data-target={`${tab.id}-input`}
                          title={tab.button_text}
                        >
                          <svg class="w-5 h-5 text-neutral-500 dark:text-neutral-400 group-focus-within:text-blue-600 dark:group-focus-within:text-blue-400 transition-colors" 
                               fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                          </svg>
                        </button>
                      </div>
                    </div>

                    <!-- 复制按钮 -->
                    <div class="mb-6">
                      <button 
                        class="w-full py-3 px-6 cursor-pointer bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors duration-200"
                        data-copy-target={`${tab.id}-input`}
                        data-copy-button
                      >
                        <svg class="w-4 h-4 mr-2 inline-block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                        </svg>
                        <span class="copy-text">{tab.button_text}</span>
                      </button>
                    </div>
                    <div class="flex items-start">
                      <div
                        class={`flex-shrink-0 w-10 h-10 ${tab.content.icon_bg_color} rounded-lg flex items-center justify-center mr-4`}
                      >
                        <svg
                          class={`w-5 h-5 ${tab.content.icon_color}`}
                          fill="currentColor"
                          viewBox="0 0 20 20"
                        >
                          <path
                            fill-rule="evenodd"
                            d={tab.icon_path}
                            clip-rule="evenodd"></path>
                        </svg>
                      </div>
                      <div class="flex-1">
                        <h3
                          class="text-neutral-800 dark:text-neutral-200 font-semibold text-lg mb-2"
                        >
                          {tab.content.title}
                        </h3>
                        <p
                          class="text-neutral-600 dark:text-neutral-300 text-sm mb-4"
                        >
                          {tab.content.description}
                        </p>
                        <div
                          class="bg-white dark:bg-neutral-900 rounded-lg p-4 border border-neutral-200 dark:border-neutral-700"
                        >
                          <p
                            class="text-neutral-800 dark:text-neutral-200 font-medium mb-2"
                          >
                            {tab.content.info_title}
                          </p>
                          <ul
                            class="text-neutral-600 dark:text-neutral-300 text-sm space-y-1 list-disc list-inside"
                          >
                            {tab.content.info_items?.map((item) => (
                              <li>{item}</li>
                            ))}
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}


        </div>
      </div>
    </div>
    <div class="container mt-10">
      <div class="flex justify-center">
        <div>
          <!-- <Waline 
            serverURL="https://astrogitproxy-ptk3iifbf-dong-hes-projects.vercel.app/"
            placeholder="欢迎在此留言讨论！"
            lang="zh-CN"
            visitor={true}
            highlight={true}
            imageUploader={true}
            reaction={true}
            search={true}
            pageSize={10}
            copyright={true}
          /> -->
        </div>
      </div>
    </div>
  </section>

  <!-- <Separator text="Check out my projects" /> -->
  <!-- <Projects /> -->
  <Separator text="Some of my writing" />
  <Writings />
</Layout>
